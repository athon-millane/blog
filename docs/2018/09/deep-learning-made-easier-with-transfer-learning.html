<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Deep learning made easier with transfer learning</title>
    <link rel="stylesheet" type="text/css" href="/style.css" />
  </head>
  <body>
      <main id="main">
        
<div class="container">
<div class="spacer"></div>
<a href="https://www.cloudera.com/products/fast-forward-labs-research.html">
  <img style="height: 0.8rem;" src="/images/cloudera-fast-forward-logo.png" />
</a>
<div class="spacer"></div>
<div>
  <h3 style="margin: 0"><a href="/">Blog</a></h3>
</div>
<div class="post">
  <div class="spacer"></div>
  <h5 style="margin-bottom: 4px;">
    <span>Sep 17, 2018</span> &middot;
    <span style="text-transform: capitalize;">
      
      post
      
    </span>
  </h5>
  <h1>Deep learning made easier with transfer learning</h1>
  <!-- raw HTML omitted -->
<p>Deep learning has provided extraordinary advances in problem spaces that
are poorly solved by other approaches. This success is due to several key
departures from traditional machine learning that allow it to excel when
applied to unstructured data. Today, deep learning models can play games,
detect cancer, talk to humans, and drive cars.</p>
<p>But the differences that make deep learning powerful also make it costly.
You may have heard that deep learning success requires massive data, expensive
hardware, and even more expensive elite engineering talent.</p>
<p>At Cloudera Fast Forward Labs, we&rsquo;re particularly excited about innovations
that lessen these challenges. Our <a href="/2018/07/24/ff08-launch.html">latest research report goes in depth on
multi-task learning</a>, an approach that allows
machine learning models to learn from multiple tasks at once. Among its many
benefits, this approach can reduce training data requirements.</p>
<p>In this article, we&rsquo;re going to look at transfer learning, a related technique
that enables the transfer of knowledge from one task to another. Rather than
developing an entirely customized solution to your problem, transfer learning
allows you to transfer knowledge from related problems to help solve your
custom problem more easily. By transferring that knowledge, you are taking
advantage of the expensive resources that were used to acquire it - training data,
hardware, researchers - without the incurring the cost. Let&rsquo;s see how
and when this approach is effective.</p>
<h2 id="why-deep-learning-is-different">Why deep learning is different</h2>
<p>Transfer learning is not a new technique, nor is it specific to deep learning,
but it is <em>newly exciting</em> in light of the recent progress in deep learning. So
first, it&rsquo;s important to spell out the ways in which deep learning is different
than traditional machine learning.</p>
<h3 id="deep-learning-operates-at-a-lower-level-of-abstraction">Deep learning operates at a lower level of abstraction</h3>
<p>Machine learning is a way for machines to automatically learn functions which
assign predictions or labels to numerical inputs, i.e. data.</p>
<p><img src="/images/editor_uploads/2018-09-18-165643-ml_function_1.png" alt=""></p>
<p>The difficult part here is determining exactly how the function produces the
output from the provided input. Without any restrictions on the function, the
possibilities (and complexities) are endless. In order to simplify this task,
we usually impose some type of structure on the function - based on the type of
problem we’re solving, domain expertise, or simply trial and error. That
structure defines a type of machine learning model.</p>
<p><img src="/images/editor_uploads/2018-09-18-165658-ml_function_2.png" alt=""></p>
<p>In theory, there are an infinity of possible structures, but in practice most
machine learning use cases can be solved by applying one of only a handful of
structures: linear models, ensembles of trees, and support vector machines make
up a solid core. The data scientist’s job is then to choose the correct
structure from this small set of possible structures.</p>
<p><img src="/images/editor_uploads/2018-09-18-170135-ml_function_3.png" alt=""></p>
<p>These models are available as black box objects from a variety of mature
machine learning libraries, and can be trained in just a few lines of code. For
example, you can train a random forest model using Python&rsquo;s
<a href="http://scikit-learn.org/">scikit-learn</a> like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">clf <span style="color:#f92672">=</span> RandomForestClassifier()
clf<span style="color:#f92672">.</span>fit(past_data, labels)
predictions <span style="color:#f92672">=</span> clf<span style="color:#f92672">.</span>predict(future_data)
</code></pre></div><p>Or a linear regression model in R:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">linearModel <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">lm</span>(y <span style="color:#f92672">~</span> X, data<span style="color:#f92672">=</span>pastData)
predictions <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">predict</span>(linearModel, futureData)
</code></pre></div><p>Deep learning, however, operates at a lower level. Rather than choosing among a
small, finite set of model structures, deep learning allows practitioners to
compose arbitrary structures. The building blocks are modules or layers that
can be thought of as basic, fundamental data transformations. This means that
we need to open up the black box when applying deep learning, instead of
treating it as fixed by the algorithm.</p>
<p><img src="/images/editor_uploads/2018-09-18-170159-ml_function_4.png" alt=""></p>
<p>This allows more powerful models to be built, but it also adds an entirely new
dimension to the model building process. Composing these transformations
effectively can be a difficult process, despite the volume of published deep
learning research, <a href="https://developers.google.com/machine-learning/guides/text-classification/">practical
guidelines</a>
and folk wisdom.</p>
<p>Consider an extremely simple Convolutional Neural Network image classifier,
defined here in the popular deep learning library PyTorch.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Net</span>(nn<span style="color:#f92672">.</span>Module):
    <span style="color:#66d9ef">def</span> __init__(self):
        super(Net, self)<span style="color:#f92672">.</span>__init__()
        self<span style="color:#f92672">.</span>conv1 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Conv2d(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>, kernel_size<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
        self<span style="color:#f92672">.</span>conv2 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Conv2d(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>, kernel_size<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
        self<span style="color:#f92672">.</span>conv2_drop <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Dropout2d()
        self<span style="color:#f92672">.</span>fc1 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Linear(<span style="color:#ae81ff">320</span>, <span style="color:#ae81ff">50</span>)
        self<span style="color:#f92672">.</span>fc2 <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Linear(<span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">10</span>)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forward</span>(self, x):
        x <span style="color:#f92672">=</span> F<span style="color:#f92672">.</span>relu(F<span style="color:#f92672">.</span>max_pool2d(self<span style="color:#f92672">.</span>conv1(x), <span style="color:#ae81ff">2</span>))
        x <span style="color:#f92672">=</span> F<span style="color:#f92672">.</span>relu(F<span style="color:#f92672">.</span>max_pool2d(self<span style="color:#f92672">.</span>conv2_drop(self<span style="color:#f92672">.</span>conv2(x)), <span style="color:#ae81ff">2</span>))
        x <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span>view(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">320</span>)
        x <span style="color:#f92672">=</span> F<span style="color:#f92672">.</span>relu(self<span style="color:#f92672">.</span>fc1(x))
        x <span style="color:#f92672">=</span> F<span style="color:#f92672">.</span>dropout(x, training<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>training)
        x <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>fc2(x)
        <span style="color:#66d9ef">return</span> F<span style="color:#f92672">.</span>log_softmax(x, dim<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</code></pre></div><h5 id="source-pytorchhttpsgithubcompytorchexamplesblobmastermnistmainpy">Source: <a href="https://github.com/pytorch/examples/blob/master/mnist/main.py">PyTorch</a></h5>
<p>Because we are working with low level building blocks, we can change a
single component of the model (e.g. <code>F.relu</code> to <code>F.sigmoid</code>, for instance).
This gives us an entirely new model architecture that may yield dramatically
different results. And the possibilities are literally endless.</p>
<h3 id="deep-learning-is-not-yet-well-understood">Deep learning is not yet well-understood</h3>
<p>Even given a fixed neural network architecture, training is notoriously
difficult. First, deep learning loss functions are not in general convex, which
means that training does not necessarily yield the best possible solution.
Second, deep learning is still very new and many of its components are not well-understood. For example, <a href="https://arxiv.org/abs/1502.03167">batch
normalization</a> has received attention
recently because its inclusion in some models seems to be critical for good
results, but <a href="https://arxiv.org/abs/1805.11604v2">experts cannot agree</a> on why.
Researcher Ali Rahimi caused some controversy when he went so far as to <a href="http://www.argmin.net/2017/12/05/kitchen-sinks/">liken
deep learning to alchemy</a> at a
recent machine learning conference.</p>
<h3 id="automatic-feature-engineering">Automatic Feature Engineering</h3>
<p>The added complexity in deep learning enables a technique called <a href="https://en.wikipedia.org/wiki/Feature_learning">representation
learning</a>, which is why it&rsquo;s
often stated that neural networks do &ldquo;automatic feature engineering.&rdquo; In short,
instead of having a human hand-engineer helpful features from a dataset, we
build models in such a way that they can learn whatever features are necessary
and helpful for the task at hand. Offloading feature engineering onto the model
is immensely powerful, but comes with the cost of models that require massive amounts
of data and, consequently, massive computing power.</p>
<h2 id="what-you-can-do-about-it">What you can do about it</h2>
<p>Deep learning is so complex in comparison to other machine learning methods,
that it can seem too overwhelming to incorporate into your business. For
resource-constrained organizations, this feeling is magnified.</p>
<p>For organizations that truly need to operate on the bleeding edge, it may
indeed be necessary to hire experts and purchase specialized hardware. But this
is not necessary in many cases. There are ways to apply it effectively without
making enormous investments. This is where transfer learning comes in.</p>
<p>Transfer learning enables the transfer of knowledge from one machine learning
model to another. These models may be the result of years of research into
model structure, trained on colossal datasets, and optimized over years of
compute time. With transfer learning you can get much of the benefit of this
work for none of the cost!</p>
<h2 id="what-is-transfer-learning">What is transfer learning?</h2>
<p>Most machine learning tasks start with zero knowledge, meaning that the
structure and parameters of the model begins as random guesses. This is what we
mean when we say a model is learned <em>from scratch</em>.</p>
<p><img src="/images/editor_uploads/2018-09-18-170232-robot_share_1.png" alt=""></p>
<h5 id="a-cat-detector-model-trained-from-scratch-starts-by-guessing-it-gradually-learns-what-a-cat-is-by-aggregating-common-patterns-across-the-many-different-cats-it-has-seen">A cat detector model trained from scratch starts by guessing. It gradually learns what a cat is by aggregating common patterns across the many different cats it has seen.</h5>
<p>In this situation, everything the model learns comes from the data that you
show it. But is this the only way of solving a problem? In some cases, it might
seem like it.</p>
<p><img src="/images/editor_uploads/2018-09-18-170302-robot_share_2.png" alt=""></p>
<h5 id="a-cat-detector-model-is-likely-useless-in-unrelated-applications-like-fraud-detection-it-only-knows-how-to-make-sense-of-cat-pictures-not-credit-card-transactions">A cat detector model is likely useless in unrelated applications, like fraud detection. It only knows how to make sense of cat pictures, not credit card transactions.</h5>
<p>But in other cases, it seems like we should be able to share information between
tasks.</p>
<p><img src="/images/editor_uploads/2018-09-18-170328-robot_share_3.png" alt=""></p>
<h5 id="a-cat-detector-_is-helpful_-in-related-tasks-like-cat-facial-location-the-detector-should-already-know-how-to-detect-whiskers-noses-and-eyes---all-things-that-are-useful-in-locating-the-cats-face">A cat detector <em>is helpful</em> in related tasks, like cat facial location. The detector should already know how to detect whiskers, noses, and eyes - all things that are useful in locating the cat&rsquo;s face.</h5>
<p>This is the essence of transfer learning: taking a model that has learned how
to do one task very well and transferring some (or all) of that knowledge to a
related task.</p>
<p>This makes sense when we examine our own learning experiences; we regularly
transfer skills learned in the past to more quickly learn new skills. For
example, someone who has learned to throw a baseball does not need to
completely re-learn the mechanics of throwing a projectile to learn how to
throw a football. These things are inherently related, and the ability to do
one of them well naturally translates into the ability to do the other.</p>
<p>In the machine learning world, there is perhaps no better example than the
field of computer vision over the last five years. It is now exceedingly rare
to train an image model from scratch. Instead, we start with a pretrained model
that already knows how to classify simple objects such as cats and dogs and
umbrellas. Models that learn to classify images do so by
first learning to <a href="https://arxiv.org/abs/1311.2901">detect general image
features</a>, such as edges, shapes, text, and
faces. The pretrained model has these fundamental skills (as well as more
specific skills, such as distinguishing between dogs and cats).</p>
<p>The pretrained classification model can then be <em>slightly</em> modified by adding
layers or retraining on a new dataset, to carry over those expensively acquired
fundamental skills to a new specialization. This is transfer learning.</p>
<p>The benefits of this approach are far-reaching.</p>
<h3 id="transfer-learning-needs-less-training-data">Transfer learning needs less training data</h3>
<p>When you re-use your favorite cat detection model in a new, cat-related task,
your model already has &ldquo;the wisdom of one million cats,&rdquo; which means that you
don’t need to use nearly as many cat pictures to train the new task. Reducing
the size of training data can enable you to train in settings where there is
very little data available and where more data may be expensive or impossible to
obtain, and can also allow you to train models faster on cheaper hardware.</p>
<h3 id="models-learned-by-transfer-learning-generalize-better">Models learned by transfer learning generalize better</h3>
<p>Transfer learning improves generalization, or the ability of the model to
perform well on data that it wasn&rsquo;t trained on. This is because pre-trained
models are purposefully trained on tasks that force the model to learn generic
features that are useful in related contexts. When the model is transferred to
a new task, it will be difficult to overfit to the new training data, since the
model will only learn incrementally from a very general knowledge base.
Building a model that generalizes well is one of the <a href="https://twitter.com/mat_kelcey/status/1037812291092111360">hardest and most
important parts of machine
learning</a>.</p>
<h3 id="the-transfer-learning-training-process-is-less-brittle">The transfer learning training process is less brittle</h3>
<p>Starting with a pre-trained model also helps overcome the frustrating, brittle,
and confusing process of training a complex model with millions of parameters.
Transfer learning reduces the number of trainable parameters by as much as
100%, making training more stable and easier to debug.</p>
<h3 id="transfer-learning-makes-deep-learning-easier">Transfer learning makes deep learning easier</h3>
<p>Finally, transfer learning helps make deep learning more accessible, since you
don’t need to be an expert yourself to obtain expert level results. Consider
the popular image classification model
<a href="https://arxiv.org/abs/1512.03385">Resnet-50</a>.</p>
<p><img src="/images/editor_uploads/2018-09-18-181622-resnet50.png" alt=""></p>
<p>How was that particular architecture chosen? It is the result of years of
research and experimentation from various deep learning experts. Within this
complicated structure there are 25 million weights, and optimizing these
weights from scratch can be near impossible without extensive knowledge of each
of the model’s components. Fortunately, with transfer learning you can re-use
both the complicated structure and optimized weights, significantly lowering
the barrier to entry for deep learning.</p>
<h2 id="what-about-multi-task-learning">What about multi-task learning?</h2>
<p>Transfer learning is one of a family of knowledge sharing techniques for
training machine learning models that has proven to be extremely effective.
Currently, the two most interesting of these techniques are transfer and
multi-task learning. In transfer learning, a model is trained on a single task
and then used as a starting point for a related task. In learning the related
task, the original transferred model will learn to specialize in the new task,
without concern of how that affects its performance on the original task. In
multi-task learning, a single model learns to do multiple tasks at once, and
the evaluation of its performance depends on how well it learns to do all
those tasks. For a more detailed discussion on the benefits of multi-task
learning and when it may be useful, see our latest <a href="https://blog.fastforwardlabs.com/2018/07/24/ff08-launch.html">research on multi-task
learning</a>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Transfer learning is a knowledge-sharing technique that reduces the amount of
training data, computing power, and engineering talent needed to build deep
learning models. And since deep learning can provide significant improvements
over its counterparts from traditional machine learning, transfer learning is
an essential tool.</p>

  <div class="spacer"></div>
  <hr />
</div>
</div>

      </main>
      <div class="container">
        <div style="padding-bottom: 1rem">
          <h2 style="margin-top: 0; margin-bottom: 0px;">About</h2>
          <p style="margin-bottom: 0px;">
            Cloudera Fast Forward is an applied machine learning research group.
          </p>
          <a
            href="https://www.cloudera.com/products/fast-forward-labs-research.html"
            >Cloudera</a
          >&nbsp;
          <a href="http://experiments.fastforwardlabs.com">Experiments</a>&nbsp;
          <a href="https://twitter.com/fastforwardlabs">Twitter</a>
          <p></p>
        </div>
      </div>
  </body>
</html>
